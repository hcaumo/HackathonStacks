"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fetchLegacyWalletConfig = void 0;
const encryption_1 = require("@stacks/encryption");
const network_1 = require("@stacks/network");
const derive_1 = require("../derive");
const common_1 = require("./common");
async function fetchLegacyWalletConfig({ wallet, gaiaHubConfig, fetchFn = (0, network_1.createFetchFn)(), }) {
    const rootNode = (0, common_1.getRootNode)(wallet);
    const legacyConfigKey = (0, derive_1.deriveLegacyConfigPrivateKey)(rootNode);
    try {
        const response = await fetchFn(`${gaiaHubConfig.url_prefix}${gaiaHubConfig.address}/wallet-config.json`);
        if (!response.ok)
            return null;
        const encrypted = await response.text();
        const configJSON = (await (0, encryption_1.decryptContent)(encrypted, {
            privateKey: legacyConfigKey,
        }));
        const config = JSON.parse(configJSON);
        return config;
    }
    catch (error) {
        console.error(error);
        return null;
    }
}
exports.fetchLegacyWalletConfig = fetchLegacyWalletConfig;
//# sourceMappingURL=legacy-wallet-config.js.map